<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/carbon-route/carbon-route.html">

<link rel="import" href="./blog-list.html">

<dom-module id="blog-pages">

  <template>

    <carbon-route route="{{route}}"
                  pattern="/posts/:slug"
                  data="{{postsData}}"></carbon-route>

    <carbon-route route="{{route}}"
                  pattern="/:page"
                  data="{{pageData}}"></carbon-route>


    <neon-animated-pages id="pages"
                         selected="{{pageData.page}}"
                         attr-for-selected="data-page"
                         selected-attribute="selected">

      <blog-list id="blogList" data-page=""
                 header-settings="{{headerSettings}}"
                 posts="{{posts}}"></blog-list>

      <post-page data-page="posts"
                 header-settings="{{headerSettings}}"
                 posts="{{posts}}"
                 post-id="{{postsData.slug}}"></post-page>

    </neon-animated-pages>

  </template>

  <script>
    (function () {
      'use strict';

      class BlogPages {

        get behaviors() {
          return [
            Polymer.NeonAnimatableBehavior
          ];
        }

        beforeRegister() {
          this.is = this.constructor.name.replace(/\W+/g, '-')
            .replace(/([a-z\d])([A-Z])/g, '$1-$2').toLowerCase();
          this.properties = {
            posts: Array,
            headerSettings: {
              type: Object,
              notify: true
            },
            route: {
              type: Object,
              observer: 'routeChange'
            },
            animationConfig: {
              type: Object,
              value: function () {
                return {
                  'entry': [{
                    name: 'fade-in-animation',
                    animation: 'fade-in-animation',
                    node: this,
                    timing: {
                      delay: 500
                    }
                  }],
                  'exit': [{
                    name: 'fade-out-animation',
                    animation: 'fade-out-animation',
                    node: this
                  }]
                };
              }
            }
          };
        }

        routeChange() {
          if(this.pageData.page === this.$.pages.selected) {
            let tempSelection = this.$.pages.selected;
            this.$.pages.select(null);
            this.$.pages.select(tempSelection);
            if(this.$.pages.selectedItem){
              this.$.pages.selectedItem.playAnimation('entry');
            }
          }
        }

      }

      Polymer(BlogPages);

    })();
  </script>

</dom-module>
