<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-scroll-effects/effects/waterfall.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">

<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="../../bower_components/plastic-image/plastic-image.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-overlay-behavior/iron-overlay-behavior.html">
<link rel="import" href="../../bower_components/marked-element/marked-element.html">

<link rel="import" href="../mixins/utils-functions.html">
<link rel="import" href="../mixins/redux-mixin.html">
<link rel="import" href="./text-truncate.html">
<link rel="import" href="./shared-styles.html">

<dom-module id="speaker-details">
  <template>
    <style is="custom-style" include="shared-styles flex flex-alignment positioning"></style>

    <style>

      :host {
        margin: 0;
        display: block;
        height: 100%;
        width: 100%;
        background: #fff;
        box-shadow: var(--box-shadow);
      }

      app-header {
        background-color: var(--additional-background-color);
      }

      .header-toolbar {
        padding: 8px 0;
        border-bottom: 1px solid var(--border-light-color);
        color: var(--secondary-text-color);
        height: auto;
      }

      .photo {
        margin-right: 16px;
        width: 72px;
        height: 72px;
        background-color: var(--contrast-additional-background-color);
        border: 5px solid var(--contrast-additional-background-color);
        border-radius: 50%;
        transform: translateZ(0);
      }

      .header-content {
        padding: 16px 8px;
        height: auto;
      }

      .name {
        line-height: 1.1;
      }

      .content {
        padding: 24px 16px;
      }

      .content-list {
        margin: 0;
        padding: 0;
        color: var(--secondary-text-color);
      }

      .content-list-details {
        margin-bottom: 16px;
      }

      .content-list-icon {
        margin: 2px 43px 0 19px;
        --iron-icon-width: 18px;
        --iron-icon-height: 18px;
      }

      .contacts {
        margin-top: 8px;
        margin-left: 80px;
        --iron-icon-fill-color: var(--secondary-text-color);
      }

      @media (min-width: 812px) {
        :host {
          height: 70%;
          width: 800px;
        }

        .header-toolbar {
          padding: 16px 0;
        }

        .header-content,
        .content {
          padding: 24px;
        }

        .content-list-icon {
          margin-left: 27px;
        }
      }

    </style>

    <app-header-layout has-scrolling-region fit>
      <app-header slot="header" class="header" fixed effects="waterfall">

        <app-toolbar class="header-toolbar" hidden$="[[viewport.isTabletPlus]]">
          <paper-icon-button
            icon="hoverboard:close"
            on-tap="close"
          ></paper-icon-button>
        </app-toolbar>

        <app-toolbar class="header-content" layout horizontal center>
          <plastic-image
            class="photo"
            srcset="[[speaker.photoUrl]]"
            sizing="cover"
            lazy-load preload fade
          ></plastic-image>
          <h2 class="name" flex>[[speaker.name]]</h2>
          <paper-icon-button
            icon="hoverboard:close"
            on-tap="close"
            hidden$="[[viewport.isPhone]]"
          ></paper-icon-button>
        </app-toolbar>
      </app-header>

      <div class="content">
        <ul class="content-list">
          <li class="content-list-item" layout horizontal>
            <iron-icon class="content-list-icon" icon="hoverboard:location"></iron-icon>
            <div class="content-list-details" flex>[[speaker.country]]</div>
          </li>
          <li class="content-list-item" layout horizontal>
            <iron-icon class="content-list-icon" icon="hoverboard:work"></iron-icon>
            <div class="content-list-details" flex>[[speaker.title]], [[speaker.company]]</div>
          </li>
          <li class="content-list-item" hidden$="[[isEmpty(speaker.badges)]]" layout horizontal>
            <iron-icon class="content-list-icon" icon="hoverboard:achievement"></iron-icon>
            <div flex>
              <template is="dom-repeat" items="[[speaker.badges]]" as="badge">
                <div class="content-list-details">
                  <a
                    class$="badge"
                    href$="[[badge.link]]"
                    target="_blank"
                    rel="noopener noreferrer"
                    title$="[[badge.description]]"
                  >
                    [[badge.description]]
                  </a>
                </div>
              </template>
            </div>
          </li>
          <li class="content-list-item" layout horizontal>
            <iron-icon class="content-list-icon" icon="hoverboard:document"></iron-icon>
            <div class="content-list-details" flex>[[speaker.bio]]</div>
          </li>
        </ul>

        <div class="contacts">
          <template is="dom-repeat" items="[[speaker.socials]]" as="social">
            <a href="[[social.link]]" target="_blank" rel="noopener noreferrer">
              <paper-icon-button
                class="social-icon"
                icon="hoverboard:{{social.icon}}"
              ></paper-icon-button>
            </a>
          </template>
        </div>
      </div>
    </app-header-layout>

  </template>

  <script>

    class SpeakerDetails extends UtilsFunctions(ReduxMixin(Polymer.mixinBehaviors([Polymer.IronOverlayBehavior], Polymer.Element))) {
      static get is() {
        return 'speaker-details';
      }

      static get properties() {
        return {
          speaker: {
            type: Object
          },
          viewport: {
            type: Object,
            statePath: 'ui.viewport'
          }
        }
      }

      static get observers() {
        return [
          '_handleClose(opened, speaker)'
        ];
      }

      _handleClose(opened, speaker) {
        if (!opened && speaker && Object.keys(speaker).length) {
          history.back();
        }
      }
    }

    customElements.define(SpeakerDetails.is, SpeakerDetails);
  </script>
</dom-module>
