<link rel='import' href='../../bower_components/polymer/polymer.html'>

<script>
  (function () {
    'use strict';

    /**
     * @polymerBehavior HOVERBOARD.MyScheduleBehavior
     */
    HOVERBOARD.MyScheduleBehavior = {

      properties: {
        app: {
          type: Object,
          notify: true
        }
      },

      toggleMyScheduleSession: function (e) {
        e.stopPropagation();
        e.preventDefault();

        if (!this.online) {
          HOVERBOARD.Elements.Template.$.toast.showMessage('{$ offlineMessage $}');
          return;
        }

        if (!this.app.user) {
          var signIn = function () {
            HOVERBOARD.Elements.Template.signIn();
          };
          HOVERBOARD.Elements.Template.$.toast.showMessage(
            '{$ youShouldSignInSessions $}', signIn, '{$ signIn $}');
          return;
        }

        var id = e.target.getAttribute('session-id');
        var track = e.target.getAttribute('session-track');
        var isWorkshop = track && track.toLowerCase() == 'workshops hall';

        if (this.app.user.sessions && this.app.user.sessions[id]) {
          this.set('app.user.sessions.' + id, null);
          HOVERBOARD.Elements.Template.$.toast.showMessage('{$ removedFromSchedule $}');
        } else {
          if (!this.app.user.sessions) {
            this.app.user.sessions = {};
          }
          this.set('app.user.sessions.' + id, true);    
          
          // [temp fix] to trigger app.sessions observer and re-filter my-schedule
          // @ozasadnyy, I hope you won't have heart attack
          // DevFest is coming :)
          this.set('app.user.sessions.000', null);          
          HOVERBOARD.Elements.Template.$.toast.showMessage('{$ addedToSchedule $}');     

          if (isWorkshop) {
            this.close && this.close();
            HOVERBOARD.Elements.Template.$.infoDialog.headerText = '{$ workshopWarning.headerText $}';
            HOVERBOARD.Elements.Template.$.infoDialog.infoText = '{$ workshopWarning.infoText $}';
            HOVERBOARD.Elements.Template.$.infoDialog.ctaButtonText = '{$ workshopWarning.ctaButtonText $}';
            
            HOVERBOARD.Elements.Template.$.infoDialog.open();
          }
        }
      },

      isInMySchedule: function (id) {
        if (!this.app.user) return false;
        if (!this.app.user.sessions) {
          this.app.user.sessions = {};
        }
        return !!this.app.user.sessions[id];
      }

    };

  }());
</script>
